apiVersion: 1
providers:
  - name: FAME Training Overview
    orgId: 1
    folder: FAME Dashboards
    type: file
    disableDeletion: false
    editable: true
    options:
      path: /var/lib/grafana/dashboards/fame-training

dashboard:
  title: "Training & Continuous Learning"
  description: "Performance monitoring for live training loops"
  tags: ["FAME", "Training"]
  timezone: browser
  refresh: 30s
  panels:
    - title: "Average Reward by Policy"
      type: timeseries
      gridPos: { h: 8, w: 12, x: 0, y: 0 }
      targets:
        - expr: training_policy_reward_avg
          legendFormat: "{{policy_version}}"
      fieldConfig:
        defaults:
          unit: none
          thresholds:
            mode: absolute
            steps:
              - color: red
                value: 0
              - color: orange
                value: 0.3
              - color: green
                value: 0.6

    - title: "Win Rate by Policy"
      type: timeseries
      gridPos: { h: 8, w: 12, x: 12, y: 0 }
      targets:
        - expr: training_policy_win_rate
          legendFormat: "{{policy_version}}"
      fieldConfig:
        defaults:
          unit: percentunit

    - title: "Rolling ROI"
      type: timeseries
      gridPos: { h: 8, w: 12, x: 0, y: 8 }
      targets:
        - expr: training_policy_rolling_roi
          legendFormat: "{{policy_version}}"
      fieldConfig:
        defaults:
          unit: percentunit

    - title: "Experience Buffer Size"
      type: stat
      gridPos: { h: 8, w: 6, x: 12, y: 8 }
      targets:
        - expr: training_experience_buffer_size
          legendFormat: "Buffer Size"
      fieldConfig:
        defaults:
          unit: short

    - title: "Policy Drift Score"
      type: timeseries
      gridPos: { h: 8, w: 12, x: 0, y: 16 }
      targets:
        - expr: rate(training_policy_drift_score_sum[5m]) / clamp_min(rate(training_policy_drift_score_count[5m]), 1)
          legendFormat: "Drift Score"
      fieldConfig:
        defaults:
          unit: none

    - title: "Training Latency"
      type: timeseries
      gridPos: { h: 8, w: 12, x: 12, y: 16 }
      targets:
        - expr: histogram_quantile(0.95, rate(training_policy_latency_ms_bucket[5m]))
          legendFormat: "p95"
        - expr: histogram_quantile(0.50, rate(training_policy_latency_ms_bucket[5m]))
          legendFormat: "p50"
      fieldConfig:
        defaults:
          unit: milliseconds


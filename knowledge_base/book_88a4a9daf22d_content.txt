Kali Linux 2018: WindowsPenetration TestingSecond EditionConduct network testing, surveillance, and pen testing on MSWindows using Kali Linux 2018Wolf HaltonBo Weaver
BIRMINGHAM - MUMBAI

Kali Linux 2018: Windows PenetrationTestingSecond EditionSecond EditionSecond EditionSecond Edition Second EditionCopyright  2018 Packt Publishing©All rights reserved. No part of this book may be reproduced, stored in a retrieval system, or transmitted in any formor by any means, without the prior written permission of the publisher, except in the case of brief quotationsembedded in critical articles or reviews.Every effort has been made in the preparation of this book to ensure the accuracy of the information presented.However, the information contained in this book is sold without warranty, either express or implied. Neither theauthors, nor Packt Publishing or its dealers and distributors, will be held liable for any damages caused or alleged tohave been caused directly or indirectly by this book.Packt Publishing has endeavored to provide trademark information about all of the companies and productsmentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee the accuracyof this information.Commissioning Editor: Vijin BorichaAcquisition Editor: Rahul NairContent Development Editor: Ronn KurienTechnical Editor: Aditya KhadyeCopy Editor: Safis EditingProject Coordinator: Jagdish PrabhuProofreader: Safis EditingIndexer: Tejal Daruwale SoniGraphics: Tom ScariaProduction Coordinator: Arvindkumar GuptaFirst published: June 2016Second edition: October 2018Production reference: 2051118Published by Packt Publishing Ltd.Livery Place35 Livery StreetBirminghamB3 2PB, UK.ISBN 978-1-78899-746-1www.packtpub.com

mapt.ioMapt is an online digital library that gives you full access to over 5,000 books and videos, aswell as industry leading tools to help you plan your personal development and advanceyour career. For more information, please visit our website.Why subscribe?Spend less time learning and more time coding with practical eBooks and Videosfrom over 4,000 industry professionalsImprove your learning with Skill Plans built especially for youGet a free eBook or video every monthMapt is fully searchableCopy and paste, print, and bookmark contentPackt.comDid you know that Packt offers eBook versions of every book published, with PDF andePub files available? You can upgrade to the eBook version at  and as a printwww.packt.combook customer, you are entitled to a discount on the eBook copy. Get in touch with us atcustomercare@packtpub.com for more details.At , you can also read a collection of free technical articles, sign up for awww.packt.comrange of free newsletters, and receive exclusive discounts and offers on Packt books andeBooks. 

ContributorsAbout the authorsWolf Halton is an , a best selling author onAuthority on Computer and Internet SecurityComputer Security, and the CEO of Atlanta Cloud Technology. He specializes inbusiness—continuity, security engineering, open source consulting, marketing automation,virtualization and data center restructuring, network architecture, and Linuxadministration. Wolf has been a security engineer since 1999 and has been training securityengineers since 2005.Bo Weaver is an old school ponytailed geek. His first involvement with networks was in1972 while in the US Navy working on a R&D project called ARPA NET. Here he alsolearned the power of UNIX and how to out smart the operating system. Bo has beenworking with and using Linux daily since the 1990's and a promoter of Open Source. (Yes,Bo runs on Linux.) Bo has also worked in physical security fields as a private investigatorand in executive protection. Bo now works as the senior penetration tester and securityresearcher for CompliancePoint a Atlanta based security consulting company.Bo is Cherokee and works with native youths to help keep native traditions alive andstrong.We would like to thank Dyana Pearson (Hacker Girl) and Joe Sikes for their input andsuggestions. Without their assistance, and humor, this book would not be what it is.This second edition is dedicated to Helen Young Halton, who was the force of nature thatkept Wolf on track for their 14 years of marriage. Helen passed away on Star Wars Day(May the Fourth) in 2017, and so never saw the end of the story. Helen left Wolf and twogrown children, Savannah Rogers and Candler Rogers. She would be gratified and proudof the lives into which they are living. - Wolf Halton, Memorial Day 2018

About the reviewerPaolo Stagno (aka VoidSec) has worked as a consultant for a wide range of clients acrosstop tier international banks, major tech companies, and various Fortune 1000 industries. AtZeroDayLab, he was responsible for discovering and exploiting new unknownvulnerabilities in web applications, network infrastructure components, new protocols andtechnologies. He is now a freelance security researcher and a penetration tester focused onoffensive security. In his own research, he discovered various vulnerabilities in software ofmultiple vendors and tech giant such as eBay, Facebook, Google, Oracle, PayPal and manyothers. He is an active speaker in various security conferences around the globe such asHacktivity, SEC-T, HackInBo, TOHack, and Droidcon.Packt is searching for authors like youIf you're interested in becoming an author for Packt, please visit authors.packtpub.comand apply today. We have worked with thousands of developers and tech professionals,just like you, to help them share their insight with the global tech community. You canmake a general application, apply for a specific hot topic that we are recruiting an authorfor, or submit your own idea.

Table of ContentsPreface1Chapter 1: Choosing Your Distro6Desktop environments6Desktop environment versus Window Manager7Enlightenment (E17)8E17 Window Manager issues11Gnome desktop14Gnome 3 desktop issues19KDE desktop19KDE issues21LXDE desktop22LXDE issues24MATE desktop24MATE issues28Xfce desktop28Xfce issues31Choosing your look and feel32Configuring Kali to be your Daily Driver32User account setup34Summary37Chapter 2: Sharpening the Saw38Technical requirements40Installing Kali Linux to an encrypted USB drive40Prerequisites for installation42Booting up44Configuring the installation45Setting up the drive47Booting your new installation of Kali50Running Kali from the Live DVD53Installing and configuring applications55Gedit – the Gnome Text Editor56Geany – the platform-agnostic code IDE56Terminator – the Terminal emulator for multi-tasking57Etherape – the graphical protocol-analysis tool58Setting up and configuring OpenVAS59Reporting tests65KeepNote – stand-alone document organizer65Dradis – web-based document organizer67

Table of Contents
[ ii ]Running services on Kali Linux67Summary69Chapter 3: Information Gathering and Vulnerability Assessments70Technical requirements70Footprinting the network71Nmap72Zenmap75The difference verbosity makes77Scanning a network range80An annotated list of Nmap command options86Using OpenVAS92Using Maltego98Using KeepNote113Summary115Further reading116Chapter 4: Sniffing and Spoofing117Technical requirements118Sniffing and spoofing network traffic118Sniffing network traffic119tcpdump119WinDump (Windows tcpdump)126Wireshark134The packet135Working with Wireshark140Spoofing network traffic145Ettercap145Ettercap on the command line155Summary157Further reading158Chapter 5: Password Attacks159Password attack planning160Cracking the NTLM code (revisited)161Password lists162Cleaning a password list163My friend, Johnny167John the Ripper (command line)173xHydra176Summary187Further reading188Chapter 6: NetBIOS Name Service and LLMNR - Obsolete but StillDeadly189

Table of Contents
[ iii ]Technical requirements189NetBIOS name service and NTLM190Sniffing and capturing traffic193Using Ettercap data194NetBIOS scanning using NBTscan194Responder - so many hashes, so little time196Using Responder with Metasploit202NetBIOS response BadTunnel brute force spoofing210EvilGrade212Ettercap setup220The attack224Summary229Further reading229Chapter 7: Gaining Access230Pwnage230Technical requirements231Exploiting Windows systems with Metasploit232Using advanced Footprinting241Interpreting the scan and building on the result246Exploiting a 32-bit system255Accessing Systems With Xfreerdp258Summary262Further reading262Chapter 8: Windows Privilege Escalation and Maintaining Access264Technical requirements264Windows privilege escalation265Escalating your privileges265MSFvenom266MS16-032 Secondary Logon Handle Privilege Escalation276Windows Escalate Service Permissions Local Privilege Escalation278Windows Escalate UAC Protection Bypass (ScriptHostVulnerability)279Maintaining access290Remote Access Tools291Metasploit's persistence_exe module291Windows registry-only persistence297Summary302Chapter 9: Maintaining Access on Server or Desktop303Maintaining access or ET Phone Home303Covering our tracks307Maintaining access with Ncat308Setting up a NetCat Client310

Table of Contents
[ iv ]Phoning home with Metasploit312Running a port scanner inside Metasploit320The Drop Box324Cracking the Network Access Controller (NAC)326Creating a spear-phishing attack with the Social EngineeringToolkit328Using the Spear-Phishing Attack Vectors menu332Choose a subject, or write a new email message337Using Backdoor Factory to evade antivirus338Summary340Further reading340Chapter 10: Reverse Engineering and Stress Testing341Technical requirements342Setting up a test environment343Creating your victim machine(s)343Testing your testing environment343Reverse Engineering theory344One general theory of Reverse Engineering345Working with Boolean logic346Reviewing a while loop structure349Reviewing the for loop structure351Understanding the decision points352Practicing Reverse Engineering353Using debuggers354Using the Valgrind debugger355Using the EDB-Debugger356EDB-Debugger symbol mapper358Running OllyDbg359Introduction to disassemblers361Running JAD361Creating your own disassembling code with Capstone363Some miscellaneous Reverse Engineering tools364Running Radare2365The additional members of the Radare2 tool suite367Running rasm2367Running rahash2368Running radiff2369Running rafind2369Running rax2370Stress testing Windows371Dealing with Denial372Putting the network under Siege373Configuring your Siege engine375Summary377Further reading377

Table of Contents
[ v ]Other Books You May Enjoy378Index381

PrefaceMicrosoft Windows is one of the two most common OS and managing its security hasspawned the discipline of IT security. Kali Linux is the premier platform for testing andmaintaining Windows security. Kali is built on the Debian distribution of Linux and sharesthe legendary stability of that OS. This lets you focus on using the network penetration,password cracking, forensics tools and not the OS.This book has the most advanced tools and techniques to reproduce the methods used bysophisticated hackers to make you an expert in Kali Linux penetration testing. You willstart by learning about the various desktop environments that now come with Kali. Thebook covers network sniffers and analysis tools to uncover the Windows protocols in useon the network. You will see several tools to improve your average in password acquisitionfrom hash-cracking, online attacks, offline attacks, and rainbow tables to social engineering.It also demonstrates several use cases for Kali Linux tools like Social Engineering toolkit,Metasploit and so on to exploit Windows vulnerabilities.Finally, you will learn how to gain full system level access to your compromised systemand then maintain that access. By the end of this book, you will be able to quickly pen testyour system and network using easy to follow instructions and support images.Who this book is forIf you are a working ethical hacker who is looking to expand the offensive skillset with athorough understanding of Kali Linux, then this is the book for you. Prior knowledge aboutLinux operating systems, Bash terminal, and Windows command line would be highlybeneficial.

Preface
[ 2 ]What this book coversChapter 1, , discusses about the pros and cons of the different desktopChoosing Your Distroenvironments and will help you decide which desktop is right for you.Chapter 2, , introduces you to the set-up that works best, theSharpening the Sawdocumentation tools that we use to make sure that the results of the tests are prepared andpresented right, and the details of Linux services you need to use these tools.Chapter 3, , shows you how to footprintInformation Gathering and Vulnerability Assessmentsyour Windows network and discover the vulnerabilities before the bad guys do.Chapter 4, , covers network sniffers and analysis tools to uncover theSniffing and SpoofingWindows protocols in use on the network. Learn how to exploit the vulnerable Windowsnetworking components.Chapter 5, , shows you several approaches to password cracking orPassword Attacksstealing. You will see several tools to improve your average in password acquisition fromhash-cracking, online attacks, offline attacks, and rainbow tables to social engineering.Chapter 6, , helps youNetBIOS Name Service and LLMNR - Obsolete but Still Deadlyunderstand how Kali Linux is an excellent toolkit to attack obsolete protocols andapplications and obliterate expired operating systems.Chapter 7, , demonstrates several use cases for Kali Linux tools like SocialGaining AccessEngineering Toolkit, Metasploit, and so on to exploit Windows vulnerabilities. You willalso learn to use the exploit databases provided with Kali-Linux, and others. Finally, learnto use tools to exploit several common Windows vulnerabilities, and guidelines to createand implement new exploits for upcoming Windows vulnerabilities., , teaches you severalChapter 8Windows Privilege Escalation and Maintaining Accessmethods to use Kali tool-set to get admin rights on your vulnerable Windows host.Chapter 9, , covers some devious ways to maintainMaintaining Access on Server or Desktopaccess and control of a Windows machine, after you have gained access through thetechniques you learned in the previous chapters.Chapter 10, , is the beginning of how to develop anReverse Engineering and Stress Testinganti-fragile, self-healing, and Windows network. Go ahead make your servers cry!

Preface
[ 3 ]To get the most out of this bookYou will require following to code test this book:Router/firewallLinux workstation 8 cores 32 GB RAM for a VM server. (running VirtualBox)Windows 2008 server for the DC (VM)Windows 2008 server file server (VM)Win7 client (VM)Win10 client (This was a physical laptop)Laptop running Kali 4 cores 8 GB of RAM. For the attacking platform. (Mypersonal laptop)Download the color imagesWe also provide a PDF file that has color images of the screenshots/diagrams used in thisbook. You can download it here: https://www.packtpub.com/sites/default/files/downloads/9781788997461_ColorImages.pdf.Conventions usedThere are a number of text conventions used throughout this book.CodeInText: Indicates code words in text, database table names, folder names, filenames,file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is anexample: "This produces a fast scan-the  stands for Timing (from 1 to 5), and the defaultTtiming is ."-T3A block of code is set as follows:html, body, #map { height: 100%; margin: 0; padding: 0}Any command-line input or output is written as follows:nmap -v -sn 192.168.0.0/16 10.0.0.0/8nmap -v -iR 10000 -Pn -p 80

Preface
[ 4 ]Bold: Indicates a new term, an important word, or words that you see onscreen. Forexample, words in menus or dialog boxes appear in the text like this. Here is an example:"Open the Terminal from the icon on the top bar or by clicking on the menu links:ApplicationAccessoriesTerminal |  | ".Warnings or important notes appear like this.Tips and tricks appear like this.Get in touchFeedback from our readers is always welcome.General feedback: If you have questions about any aspect of this book, mention the booktitle in the subject of your message and email us at .customercare@packtpub.comErrata: Although we have taken every care to ensure the accuracy of our content, mistakesdo happen. If you have found a mistake in this book, we would be grateful if you wouldreport this to us. Please visit , selecting your book, clickingwww.packt.com/submit-errataon the Errata Submission Form link, and entering the details.Piracy: If you come across any illegal copies of our works in any form on the Internet, wewould be grateful if you would provide us with the location address or website name.Please contact us at  with a link to the material.copyright@packt.comIf you are interested in becoming an author: If there is a topic that you have expertise inand you are interested in either writing or contributing to a book, please visitauthors.packtpub.com.

Preface
[ 5 ]ReviewsPlease leave a review. Once you have read and used this book, why not leave a review onthe site that you purchased it from? Potential readers can then see and use your unbiasedopinion to make purchase decisions, we at Packt can understand what you think about ourproducts, and our authors can see your feedback on their book. Thank you!For more information about Packt, please visit .packt.comDisclaimerThe information within this book is intended to be used only in an ethical manner. Do notuse any information from the book if you do not have written permission from the ownerof the equipment. If you perform illegal actions, you are likely to be arrested andprosecuted to the full extent of the law. Packt Publishing does not take any responsibility ifyou misuse any of the information contained within the book. The information herein mustonly be used while testing environments with proper written authorizations fromappropriate persons responsible.

1111 1Choosing Your DistroSince the first edition of our book, a lot has changed with Kali Linux. Besides Kali nowbeing a Rolling Distribution, it now comes with several Desktop Environments and severaldifferent kernel architectures. This means you can run Kali from a small Raspberry Pi orfrom a full-blown workstation built for speed and power. By adding a normal user accountand a little extra configuration and packages, you can make Kali your  OS. InDaily Driverthis chapter, we will discuss the several desktop environments and the pros and cons ofeach. This will help you decide which distro to download for your trip into the world ofhacking with Kali. If you are not familiar with Linux, this chapter helps give you someunder the hood knowledge of Linux and its design.Desktop EnvironmentsChoosing your look and feelConfiguring for your Daily DriverDesktop environmentsOne of the big differences between Unix/Linux systems and Windows is they truly aremodular in design. Sure, I know Microsoft says , but this reallyWindows is modular in designisn't the case. With Windows, the desktop is . So,seamlessly integrated into the operating systemuntil Server 2012, you had to run a Windows server with a running GUI. With Server 2012,you have the option to run the machine headless, but the server's use is very limitedrunning in this mode. Try to uninstall Internet Explorer; well, you can't. Yes, InternetExplorer is an application that has one of the largest security footprints of any commonapplication. Yes, Internet Explorer has system-level access. Yes Toto, this is a problem,which we will exploit later in this book, but for this chapter let's focus on desktopenvironments.

Choosing Your DistroChapter 1
[ 7 ]Linux truly is modular in design. Linux's father is Unix, and Unix's whole design conceptwas small interactive programs that could be chained together to perform larger tasks.Linux is also designed this way. Actually, Linux is just the kernel of the operating systeminvented by one man, Linus Torvalds. Almost everything else is a collection of smallapplications bolted together to . A large and constant component set thatmake the boy gohelps the kernel interact with the hardware is encompassed by the name .GNU toolsetMost of these tools were ported from Unix, or rewritten to avoid copyright complications,but still use the same inputs and outputs.So, with this design structure, the GUI is just another module that can be changed orcompletely removed from the operating system without any effect on the lower workingparts. This gives Linux the ability to do anything from being a Smart Watch to running theHadron Collider or... be a hacking machine.Desktop environment versus Window ManagerOne important distinction that may help you understand how Desktop Environments workon Kali and other  (plural of Linux) is that of the Window Manager. A desktopLinucesenvironment, also called a GUI, generally includes folders, wallpapers, desktop widgets,icons, windows, toolbars, and interfaces for applications. The Microsoft Windows desktopenvironment may have been the first such metaphorical construct you discovered. Yoursmartphone has a desktop environment, and the dramatic failure of the Windows 8 desktopenvironment was an attempt to merge development of the Windows CE (phone GUI) andWindows 7/Server 2003 GUI. The mistake Microsoft made was assuming that there weremore workstations with touch screen capability. Plainly the technology existed, but themonitors were expensive and not in wide use. Bo and Wolf think the Ubuntu Unity desktopenvironment was a failure based upon the same design assumption. Mouse-drivenworkstation interfaces are here to stay for a little while longer.In Kali, a desktop environment usually interacts with a Windowing System such as the XWindows System, or Wayland, which runs directly on top of the hardware, and a WindowManager application which is the interface the user sees and with which the user interacts.The Window Manager provides the look and feel of the Kali Linux experience. There areseveral Window Managers that can be used with almost any desktop environment in KaliLinux. One of these is the Enlightenment Window Manager, which is included in Kali ISOdownloads as E17. The main difference between E17 and a full desktop environment, suchas KDE or Gnome, is that E17 has few applications that are built specifically for E17,whereas KDE and Gnome have specialized apps that need a large number of dependenciesmet to run them in some other desktop environment. Kate and gedit are the specialized texteditors for KDE and Gnome respectively.

Choosing Your DistroChapter 1
[ 8 ]Enlightenment (E17)Installing the E17 ISO is rather similar to the installations of any of the other desktops, aslong as you are using the default install option. The standard boot screen is runlevel 3, withonly a command-line interface, so you have to use the  command to see the desktopstartxinterface. This is shown in the following screenshot:
E17 startup screenOn your first login to the E17 environment, you will be asked a series of questions youalready answered in the installation process:Language: The default highlighted is US English.Keyboard Layout: The default highlighted is English (US).ProfileMobileComputer: This is hardware profile and the choices are  and . Thedefault highlighted is .ComputerSizing0.82.0: This is title size. The choices are from  to . The default highlighted is1.0.

Choosing Your DistroChapter 1
[ 9 ]Window FocusClickMouse Over: The choices are  and . The default highlighted(and the general Linux default) is .Mouse OverChecking to see if Connman exists: Connman is the Enlightenment networkconnection manager. Click to install/enable Connman.Compositing: This is the source of most of the eye candy in E17. The default is toEnable Compositing, but you might want to use hardware-accelerated (Open-GL) compositing if you are doing a bare-metal installation. If there is a shortageof RAM or you are using a machine with an older processor, you might not wantto use compositing at all:
First boot compositing choices

Choosing Your DistroChapter 1
[ 10 ]UpdatesChecks for Enlightenment Updates: You can enable . The default is acheck in the box to authorize this update. If you are running within a targetnetwork, clear this checkbox. It isn't particularly stealthy to have a randomlyoccurring network check going out to  if thehttps://www.enlightenment.org/network is supposed to be Windows-only.Taskbar: Enabling the taskbar lets you see open applications and Windows onyour Kali Linux E17 desktop. This is enabled by default.Once you are through with the configurations, E17 will show you the desktop. Thefollowing screenshot shows the default desktop. The first thing you might notice is that thebackground is a flat white plate. The menu line at the top is from Virtual Box. The menu barat the lower edge is reminiscent of the Apple Mac toolbar. The floating menu bar in themiddle is achieved by right-clicking the desktop:
E17 default desktop

Choosing Your DistroChapter 1
[ 11 ]The basic default file management window is shown in the following screenshot. It isreadable but hardly exciting. If you click on the desktop menu, you can add gadgets. I haveadded a system gadget to the Taskbar, but you could just as easily place it anywhere on thedesktop. The following screenshot shows the right-click menu from the  gadget. IfBacklightyou click , you can move all the gadgets around until you click onBegin Moving GadgetsStop Moving Gadgets:
Move gadgetsE17 Window Manager issuesAlmost all of the security tools are lumped together under the ,1.Other Menuunder the , which may cramp your style somewhat.Applications Menu

Choosing Your DistroChapter 1
[ 12 ]If you open the click menu too close to the right-screen border, the submenus are2.offscreen. The effect of  overcrowding is shown in the followingOther Menuscreenshot:
Eﬀect of Other Menu overcrowdingThis version of Enlightenment is several years old. The current major version is3.22. Perhaps the folks at Offensive Security who created Kali decided to freezeEnlightenment at major version 17 because the Enlightenment developers aremoving toward using the Wayland windowing system, and by default Kali-E17is using the  windowing system.xorg

Choosing Your DistroChapter 1
[ 13 ]To check whether your version of Kali is running xorg or Wayland, typexdpyinfo on the command line. If it is running a pure Wayland environment, thecommand will fail. If it is using xorg, it will produce several lines of informationabout your video configuration. The following screenshot shows a truncatedscreen of the results on the default installation:
Truncated xpdyinfo outputThe easiest way to get at all of the security tools would appear to be opening the4.ApplicationsRun Everything |  dialog, as shown previously. I discovered thatthis returns an error code when I attempted to open , the default terminalxtermemulator in E17, to install my favorite software installer app, . I had toSynapticgo to the  |  and open xterm from there. There doesApplicationsSystem Menunot appear to be a simple fix for the failing  widget. PerhapsRun Everythingupgrading to the current stable version of Enlightenment (E22.x) would solve it,but the solution would probably require revamping the windowing system,which is a non-trivial undertaking.To install :synaptic#> apt install synaptic

Choosing Your DistroChapter 1
[ 14 ]To change wallpaper in E17, click on  |  | . ThisApplicationsSettingsWallpaper Settingsopens the dialog that is shown in the following screenshot. You can choose your owndesktop image or one of the factory images:
Change desktop wallpaperGnome desktopBack in the days of Backtrack, which was the precursor security platform to Kali Linux, thedefault desktop environment was a very stripped-down version of KDE. When Backtrackwas deprecated and Offensive Security published Kali, the default desktop was changed toGnome. Backtrack was a live-disk CD only, and was not intended to be installed on anycomputer. The Backtrack version of KDE was stripped down to be able to load from astandard CD. This stripping down removed a lot of the desktop functions. When Kali waspublished, it was designed to load from a live DVD, and to be installed on x386 andamd_64 architectures. Gnome is slightly reminiscent of the Windows 3.11 look and feel, anduses less memory to draw the desktop than KDE.

Choosing Your DistroChapter 1
[ 15 ]The Gnome desktop has been around since the early days of Linux. The Kali Linux defaultdesktop environment is Gnome 3. When you do a standard install, the desktop looks likethis:
Gnome 3 default desktop

Choosing Your DistroChapter 1
[ 16 ]The toolbar on the left border is the favorites group. When you open any application, itsicon arrives in the favorites group on the left, as can be seen in the following screenshot,where I have opened :OWASP ZAP
Adding an application to the favorites group

Choosing Your DistroChapter 1
[ 17 ]The security tool menu is found under the  tab in the upper-left corner of theApplicationsdesktop. This is a very good categorized list and makes it easier to find any tool you wish touse. The list is shown in the following screenshot:
Gnome application menu for KaliChanging the desktop image in Gnome 3 is easy, but the settings menu is a bit hard to find.It is hidden under the icon in the upper-right corner. The following screenshot shows thesystem menu, which has the sound volume control, the network connection dialog, and thesettings editor:

Choosing Your DistroChapter 1
[ 18 ]Gnome system menuMost of the settings in Gnome are found in the settings dialog, shown in the nextscreenshot. There are settings sheets for , , , , Wi-FiBackgroundNotificationsSearchRegion& LanguageUniversal AccessOnline AccountsPrivacySharingSoundPower, , , , , , , andNetwork. The following screenshot shows the desktop editor, with the default desktopimages:
Gnome settings dialog

Choosing Your DistroChapter 1
[ 19 ]To change the images, you simply click on the image you wish to change. That opens adialog box and you can choose one of several included images, or choose one of your ownfrom the images in your  directory:PicturesGnome 3 desktop issuesThere doesn't seem to be any easy way to add applications to the favorites groupThe drop-down menu bar uses a slider bar to take you down to the Usualapplications menu instead of a full-length sub-menuKDE desktopKDE has been around since the early days of Linux and is Bo Weaver's favorite. With agecomes stability and KDE is a very stable desktop. The look and feel are very similar toWindows, so for a Windows user it is easy to use. One advantage of KDE is that thedesktop is highly configurable. If you don't like what it looks like, just change it. This can bea big advantage. KDE comes with all the latest Jumping Monkeys and features. Youprobably like your desktop environment your way, like we do. It doesn't matter what latestthing has been added as long as you can configure the desktop to be the same as it has beenfor years. This helps with . Muscle memory comes into play because havingmuscle memoryeverything in the expected place makes the overhead of the job lower, because there isn'tany time spent searching for common tools you use every day. It is more effective not tohave to think about where a tool is hidden on the machine or how to save a file since thedevelopers decided the application no longer needs a menu bar. With KDE, you can changeyour desktop back to an old-school no-frills desktop with everything just like it has been foryears. If you are bored, you can customize the desktop beyond any semblance of the defaultKali look. The next screenshot shows the default desktop with the Start menu open atApplications. The menu organization is similar to the Gnome 3 menu you have alreadyseen:

Choosing Your DistroChapter 1
[ 20 ]Default KDE Kali desktopOne drawback of KDE is since it is so highly configurable and does come with a lot of built-in features, it is very heavy on the memory of the machine and puts a demand on the videocard. KDE does need to run on a modern machine with a good amount of memory. Also,being so highly configurable, it is easy to sometimes screw up your settings.

Choosing Your DistroChapter 1
[ 21 ]One advantage of KDE is the desktop widgets. Desktop widgets are small applications thatrun on the desktop to do a number of things. When hacking, you need to keep an eye onyour local system resources. There are widgets you can use to keep an eye on systemmemory, CPU, and network usage at a glance. It's a sad thing to be in the middle of work,fire up one more tool, and have your system crash because you ran out of memory. Using awidget, you can keep an eye on memory usage, network, and CPU usage.KDE also works really well when using more than one monitor and is completelyconfigurable in assigning which monitor is the main monitor and where your toolbar go. Italso reverts to using a single monitor without a reboot or playing with the configuration.This is great when your machine is a laptop that you move a lot.The KDE developers seem to understand that the desktop interface for a tablet will notwork on a workstation that uses a mouse. Since the advent of the tablet, KDE now reallycomes with two interfaces, Plasma and Neon, and they interchange when the hardwarechanges. They both use the same backend toolsets; only the look and function changeswhen changing from tablet mode to workstation mode. This was a failure with theWindows 8 desktop and also a failure with the Gnome desktop. You cannot design aninterface to work with your finger and with a mouse. What you will always end up with isan interface that doesn't work well with either.KDE issuesKDE is graphically busy and uses a lot of resources. This makes it unsuitable for a very oldmachine, or one with low graphics memory.SHOW STOPPER!: This is an installer issue, and you may not get this effect. Thefolks who created Kali Linux add updates to the ISO disk files over time, andwhen Wolf did this install, it came up with this issue. It is easy to fix, and theimportant thing is not to panic. You did nothing wrong if your install shows uplike this. After installation, the KDE instance loads to the tty1 full-screen CLI andstartxstartxxinit does not start the GUI.  is part of the  package, so you caninstall  by entering the following as root (the account you just logged inxinitas):#> xinit

Choosing Your DistroChapter 1
[ 22 ]KDE startx after installing xinitLXDE desktopLXDE, which stands for Lightweight X11 Desktop Environment, was designed in 2006 byHong Jen Yee, a Taiwanese programmer who wrote the first module of LXDE. It was a filemanager. This is reminiscent of the creation of the Linux kernel itself, where Linus Torvaldsstarted with a file manager module. Installations had problems, but the live disk seems towork well. I noticed the Kali-Linux graphical installation asks for machine domain butregular installation does not. The following screenshot shows the default LXDE desktop.

Choosing Your DistroChapter 1
[ 23 ]This desktop environment is also reminiscent of Windows XP with the menu launch buttonin the lower-left corner:
LXDE default desktop view

Choosing Your DistroChapter 1
[ 24 ]To change the desktop background, go to the menu in the lower-left corner and choosePreferencesDesktop Preferences | . The menu is shown in the next screenshot. If you wantgreat choices for background images, check out :https://pixabay.com/
LXDE desktop image preference dialogLXDE issuesSHOW STOPPERNo partition table: Graphical installation failed because planned and no creation of file systems have been plannedSHOW STOPPERNo Operating System: Regular installation failed because InstalledMATE desktopThe MATE desktop is a fork of the now-deprecated Gnome 2 desktop environment. MATEstands for MATE Advanced Traditional Environment. This is a similar structure to theGNU acronym, . The renaming of the fork to MATE avoids namingGNU is Not Unixconvention issues with the still-current Gnome 3 environment.

Choosing Your DistroChapter 1
[ 25 ]MATE includes forks of many Gnome applications, and developers have written newapplications. The names are in Spanish to reflect MATE's Argentinian origin.MATE applications include the following:Caja: File manager (from Nautilus)Atril: Document viewer (from Evince)Engrampa: Archive manager (from Archive Manager)MATE terminal: Terminal emulator (from GNOME Terminal)Marco: Window manager (from Metacity)Mozo: Menu item editor (from Alacarte)Pluma: Text editor (from Gedit)The first boot, and all subsequent boots, of MATE bring us into runlevel 3, as shown in thefollowing screenshot:
MATE ﬁrst boot

Choosing Your DistroChapter 1
[ 26 ]The default GUI for MATE is familiar to most Linux users, as it is a near-mirror image ofGnome 2. The next screenshot shows that desktop with the default Kali logo. TheApplicationsPlacesSystem, , and  menu structure has been a long-standing mark of aLinux desktop, and many longtime Linux users welcomed the efforts of the MATE team tomaintain the tradition:
MATE GUI

Choosing Your DistroChapter 1
[ 27 ]The following screenshot shows all three system menus from the MATE desktop withrepresentative submenus open. The  menu opens Caja (file management) windows:Places
MATE System menu

Choosing Your DistroChapter 1
[ 28 ]The look and feel menu offers you 12 preset appearance preferences, and those can then becustomized further. The following screenshot shows a selection of those presets:
MATE appearance presetsMATE issuesThe behavior of booting into runlevel 3 is difficult but not insurmountable, as we know totry  when faced with this screen. Depending upon the day you download MATE,startxyou might or might not run into this issue. This is the standard runlevel for servers, but youprobably want to use both GUI and CLI tools in Kali Linux.Xfce desktopThe Xfce desktop is a lightweight desktop environment and is Wolf Halton's personalfavorite. He used Xfce to conserve resources when writing the first edition of this book. Heis using it today as part of a highly customized and quixotic version of the Ubuntu Studiooperating system to work on the current edition of the book.

Choosing Your DistroChapter 1
[ 29 ]The initials are spoken in the name of this desktop environment as . It used toex-eff-cee-eebe an acronym for X-Forms Common Environment, but it uses the GTK toolkit rather thanX-Forms these days. Xfce was initially designed to be a replacement for the CDE, whichwas a Unix Common Desktop Environment in 1996, when the latter was still proprietary.Some people might consider Xfce to be a bit old-fashioned in its look and feel. The defaultXfce desktop is shown in the following screenshot:
Xfce default desktopThe toolbar at the bottom is minimal but fully functional:The first button minimizes all windows, showing the desktopThe second button opens a command-line Terminal emulator

Choosing Your DistroChapter 1
[ 30 ]The third button opens the Thunar file managerThe fourth button opens the Firefox web browserThe fifth button is the Application FinderThe sixth button is the active user's home folderThe following screenshot shows the outcome of opening the  home folder, a Terminalrootemulator, a browser window, and the application finder. The  folder has anapplicationapplication menu in it that is the same as the  button in the upper-left corner:Applications
Xfce lower toolbar illustrated

Choosing Your DistroChapter 1
[ 31 ]The most obvious way to change the personalization is to change the desktop to an imageof your choice. There are four tabs of options to make deeper, more subtle changes to the desktop environment and make Xfce your own. Three of those four tabs are shown in thefollowing screenshot:
Xfce Appearance optionsXfce issuesThere are no real showstoppers in Xfce desktops. Perhaps this is because Xfce is a verystable desktop environment; it has never brought any issues.

Choosing Your DistroChapter 1
[ 32 ]Choosing your look and feelLook and feel are subjective. Nobody has a totally average temperament. Use cases willplay a large part in your choice of hardware and the amount of customization that makesyou happy:If you are always running from USB sticks, or from live DVD disks, it is probablybest to use the Gnome 3 desktop, as it has been tested the most by developers, orthe Xfce desktop, because it uses the least resourcesIf you are installing into VMs, you might want to use the Xfce or LXDE desktopenvironments, because VMs tend to have low resource levelsIf you are loading to a dedicated server or laptop, you may have the highestresource levels, and you are unlikely to blow the OS away very often, so choosethe E17 or KDE desktops because they are the most customizableIf you already have deep understanding of any of the desktop environments, youshould probably choose that one, just for the comfort level it provides youConfiguring Kali to be your Daily DriverKali has come a long way since it was first developed. It was first a stripped-down versionof Linux designed to be run as a VM or from a USB or CD. Your tools for normalcomputing just were there. You will notice that Kali is designed to run under the rootaccount. During the setup, there isn't the normal  section in the installSet up a user accountlike most other distros. Of course, this is normally a big security no-no. A normal usershould never have root-level access to the system. Today on most Linux distros, the rootaccount is basically disabled from interactive logins, and instructions written onadministration of the system tell you to use  to gain access to system-level files. GUI-sudobased administration applications require a user to  in and use their credentials tosudoopen and save a configuration change to the system. This is a great idea for a system set upfor normal use, but when pen testing you need direct hardware and system-level access.Using  in front of every command just isn't a useful option.sudo

Choosing Your DistroChapter 1
[ 33 ]The next screenshot is of the desktop from the machine on which Bo wrote this chapter.Since he was writing a document, looking up information on the internet, and checking hisemail, he used his basic unprivileged user account. Note his personal photo on the desktop.When using more than one account on a system (especially when one of the accounts isroot), you might want to have a different wallpaper for each account. This helps remindyou how you are logged in and keeps you from doing something stupid when in the rootaccount. This also helps protect you from the nasties on the internet:
Bo Weaver's desktop

Choosing Your DistroChapter 1
[ 34 ]The following screenshot is the root desktop for this machine. There's no doubt whereyou're at when you are using this wallpaper:
Bo Weaver's root desktopUser account setupAfter you have Kali set up and running, you'll need to add the normal user account to thesystem to make it your Daily Driver. The User Manager applications were not loaded withmost of the Kali distros. They can be installed, but the easiest method and the one thatworks on all distros is the good old  command from the Terminal, as shown in theuseraddnext screenshot.

Choosing Your DistroChapter 1
[ 35 ]The user for this and all other user processes is root:
Adding an admin userTo break down the meanings of the command options, the following is an example ofadding user  with a password of . Be sure to change the username andfredPasswordpassword to your unique account; we won't allow  on our networks anymore:freduseradd -m -U -G sudo -p LamePassword fredThe flags we are using with this command are as follows:-m/home: Sets up a home directory for the user in the  directory.-U: This flag sets up a unique user group for the new user, with the group namethe same as the username.-G sudo: This adds the new user to more than his own group. You will wantyour normal user account to have sudo access, so we are adding the user to thesudo group.

Choosing Your DistroChapter 1
[ 36 ]-: This flag sets up the password for the account. Please don'tp LamePassworduse something lame here.fred: We end the command with the new username for the account.Next, just hit the  key and the new user account is set up.EnterThere are a couple of applications you'll want to load to have a working desktop: eitherLibreOffice or Apache OpenOffice, and an email client. OpenOffice is not in the Kali repos,so for this demo we will use LibreOffice. Mozilla Thunderbird is a useful email/schedulingtool. We'll use this for our demo. Kali doesn't come with an email client installed by defaultsince it is designed to run under root. A word of warning: never open emails under a rootaccount. Bad things can happen!First, make sure your package list is up to date, so run this:apt-get updateNext, install OpenOffice and Thunderbird:apt-get -y install libreoffice thunderbirdOr, use this:apt install libreoffice thunderbirdThe  flag will answer yes to installing the packages. At this point, get a cup of coffee or-ytake a little walk, as this will take a bit to install. The second command does the same thing,but it lets us look at the packages to be installed and upgraded. An abridged readout of theresults of the second command are shown in the next screenshot. This screenshot showswavy lines between the major sections of the install, to fit it all into the image window fromthe three screens of detail that are actually there. There are dozens of suggested packages,and you can ignore these and just hit the  key for yes. You can also go back later, copy allYthe suggested package names from the Terminal window, and run this command:apt install [all those names you just copied]

Choosing Your DistroChapter 1
[ 37 ]Add them into your installation:
Installing mail client and Oﬃce appsSo, now you are ready. Change your root desktop to something that reminds you that youare logged in as root. Log out of root and, at the login screen, enter the new user'scredentials. Once you are in, you now have a running account with the full security of anormal user account. Using this account, you are safe to browse the internet, read email,and do all the other things you normally do with a system. When you need to do a littlepen testing, just log in as root.SummaryIn this chapter, we have given you a short introduction to the current options for desktopenvironments and some justification for using them. Most customization happens on bare-metal installations on laptops and desktops. The least customization will happen on livedisk and USB stick use cases, as the resources are low and the changes will not be retained.

2222 2Sharpening the SawA craftsman is only as good as his tools and tools need to be set up and maintained. Sinceyou have an idea of what Kali Linux distro you are interested in installing, this chapter willhelp you set up and configure your personal versions of the platform. Kali Linux isversatile and can be used in several use cases.When you first decided to use Kali Linux, you probably hadn't thought about the variouscommon and uncommon uses. This chapter introduces you to ups that will work best foryour Windows penetration testing requirements, the documentation tools that we use tomake sure that the results of the tests are prepared and presented properly, and the detailsof Linux services that you need to operate these tools. Many books, including the first bookWolf Halton wrote about penetration testing, set its chapters in the order of the sub-menusin the Kali Security desktop. We found this to be less than intuitive. We have put all thesetup at the beginning to reduce confusion for first-time Kali users, and because somethings, such as the documentation tools, must be understood before you start using theother tools. The reason why the title of this chapter is  is because a poorSharpening the Sawworkman, or an inexperienced hacker, blames his tools, a skilled craftsman spends a bitmore time preparing tools so their work goes faster.In the Kali Gnome3 Desktop Menu, there is a sub-menu called , and on your firstFavoritesrun these tools will be the tools that the creators of Kali Linux believe to be the mostindispensable weapons for a working security analyst to understand. In this chapter, afterinstallation and setup, we are going to show you the tools we use most. These may becomeyour favorites. The following screenshot shows the Favorites menu at default. The defaultsare as follows:Firefox ESR: A web browserTerminal: A Bash Terminal emulatorFiles: A file manager similar to Windows Explorer.exemetasploit framework: the gold standard of exploit frameworksarmitage: A GUI front-end for metasploit

Sharpening the SawChapter 2
[ 39 ]burpsuite: A web-application attack proxybeef xss framework: A cross-site scripting toolfaraday IDE: A multi-user pen testing environment with over 70 supported toolsincluding Metasploit, Burpsuite, Terminal, and many othersLeafpad: Text editing application

Sharpening the SawChapter 2
[ 40 ]Many system services on Kali Linux are the same as those on Ubuntu and other Linuxservers based upon the Debian platform, but because there are security tools that use aclient/server model, there are services that will need to have their servers started early torun your tests successfully.We will learn the following topics in this chapterInstalling Kali Linux to an encrypted USB driveRunning Kali from the Live DVDInstalling and configuring applicationsSetting up and configuring OpenVASReporting testsRunning services on Kali LinuxTechnical requirementsKali distro of your choice (Gnome, KDE, LXDE, or MATE)A blank USB drive at least 16 GB in size.A laptop or workstation with manual boot optionsInstalling Kali Linux to an encrypted USBdriveSecure networking environments such as those found in most organizations that have ITdepartments present several challenges to you as a security engineer. The companyprobably has a specific list of approved applications. Antivirus applications are usuallymanaged from a central location. Security tools are miscategorized as evil hacking tools ormalware packages. Many companies have defensive rules against having any operatingsystem that isn't Microsoft Windows installed on company computing hardware.

Sharpening the SawChapter 2
[ 41 ]To add to the challenge, they prohibit non-corporate assets on the corporate network. Themain problem you will find is that there are very few economical penetration testing toolswritten for Windows, and the few, such as , that do have a Windows version,Metasploittend to fight with the lower-level operating system functions. Since most company laptopsmust have anti-virus software running on the system, you must do some serious exceptionvoodoo on Metasploit's directories. The anti-virus software will quarantine all the virusesand the tools that come with Metasploit. Also, Local Intrusion Protection Software and localfirewall rules will cause problems. These OS functions and security add-ons are designed toprevent hacking, and that is exactly what you are preparing to do.The  (PCI DSS 3.2.1)Payment Card Industry Digital Security Standardrequires that any Windows machine that handles payment data or is on anetwork with any machine that handles payment data should be patched,run a firewall, and have anti-virus software installed on it. Further, manycompany IT security policies mandate that no end user can disable anti-virus protection without penalty.Another issue with using a Windows machine as your penetration-testing machine is thatyou may do external testing from time to time. In order to do a proper external test thetesting machine must be on the public internet. It is unwise to hang a Windows machineout on the public network with your all your security applications turned off. Such aconfiguration will probably be infected with worms within 20 minutes of putting it on theinternet.So what's the answer? An encrypted bootable USB drive loaded with Kali Linux. On Kali'sinstall screen there is the option to install Kali to a USB drive with what is calledpersistence. This gives you the ability to install to a USB drive and have the ability to savefiles to the USB, but the drive is not encrypted. By mounting the USB drive with a Linuxmachine your files are there for the taking. This is fine for trying out Kali, but you don'twant real test data floating around on a USB drive. By doing a normal full install of Kali tothe USB drive, full disk encryption can be used on the disk. If the USB is compromised orlost, the data is still safe.In this chapter we will install Kali to a 64 GB USB disk. You can use a smaller one butremember you will be gathering data from your testing and even on a small network thiscan amount to a lot of data. We do testing almost daily so we used a 1 TB USB 3.0 drive.The 64 GB drive is a good size for most testing.

Sharpening the SawChapter 2
[ 42 ]Prerequisites for installationFor this chapter you will need a 64 GB thumb drive, a copy of Kali burned to a DVD and amachine with a DVD player and USB capabilities on boot. You can download Kali athttps://www.kali.org/downloads/ and look for the link to download the version youwant. The following screenshot shows part of the download page:

Sharpening the SawChapter 2
[ 43 ]Since we showed you several distributions of Kali in , , theChapter 1Choosing Your Distrofollowing screenshot shows what happens when you download all the available Kali LinuxISO files at one time.

Sharpening the SawChapter 2
[ 44 ]Booting upOnce you are ready, insert your DVD and your USB drive into your machine.Be sure and insert the USB  powering up the machine. You want thebeforemachine to see the USB on boot so the installer will see it during theinstall.Now power up the machine and you'll get the following screen. Pick Graphical installfrom the menu.
This installation will also work if you use the text installer found by picking the Installcommand on line six.

Sharpening the SawChapter 2
[ 45 ]Configuring the installationIf you have ever installed any distribution of Linux, the first section of the installationshould seem very familiar. You will see a series of screens for setting the country, language,and keyboard. Set this up for your locale and language of choice. Normally the installer willdiscover the keyboard and you can click the one chosen. The default choices in the US areUS standard English, and US standard keyboard mapping. Make appropriate changes thenclick the  button on each of these pages.ContinueAfter these configurations you'll be given the window as follows to supply a .HostnameGive it a distinctive name and not the default. This will be helpful later when using saveddata and screenshots. If you have several people using Kali and all the machines are namedKali it can be confusing as to exactly where the data came from.
The next screenshot asks for a domain name. Use a real domain name that you or yourcompany controls. Do not use a bogus domain name, such as  or . If.local.localdomainyou are doing business on the internet, or are a student and want to be a securityprofessional, please use a proper domain name. This makes tracing routes and trackingpackets easier. Domains are cheap. If the domain belongs to your employer, and you cannotjust use their domain name, request a subdomain such as .testing.mycompany.com

Sharpening the SawChapter 2
[ 46 ]In the next window you will be asked to provide a root password. Give this a STRONGpassword. The longer and more complex the password, the better. Remember, after a fewtests the keys to your network will be on this device. Unlike most computer operations,during penetration testing you will be using the root account, and not a normal useraccount. You will need the ability to open and close ports and have full control of the network stack.A standard Kali install does not offer you the chance to add a standarduser. If you install Kali on the laptop itself, and use this laptop for otherthings besides testing, create a standard user and give it sudoerprivileges. You never want to get into the habit of using your rootaccount for browsing the World Wide Web and sending emails.
Next, you will be asked to choose your time-zone. Set up by your location on the graphicalmap, or pull-down menu, or pick your UTC offset. Many tools on Kali Linux outputtimestamps and these are legal evidence that you did what you said you did, when yousaid you did it.

Sharpening the SawChapter 2
[ 47 ]Setting up the driveThe next step is setting up the drive, encrypting it, and partitioning the drive. The nextdialog will ask you to select a type of partitioning for this install.Pick . This will fully encrypt1.Guided - use entire disk and set up encrypted LVMthe entire drive, as opposed to just encrypting the  directory./home
In the next window you will be asked to pick a disk upon which to install KaliLinux.WARNING. Be careful to pick the USB disk and not your local drive. Ifyou pick your local drive you will wipe the operating system from thatdrive. Note: in the window following you can see the USB drive and aVMware virtual disk. The virtual disk is the hard drive of the virtualmachine being used for this demonstration.Pick the USB disk and click .2.Continue

Sharpening the SawChapter 2
[ 48 ]In the next window you will be asked how to partition the drive. Choose the3.default and click .ContinueNext you will be asked to save partitioning information, and this will start thepartitioning process.When you click , here all data will be lost on the disk you are installingContinueto. Click  and then .YesContinue
This will start the disk encryption and partitioning process. First the drive is fully erasedand encrypted. This will take a while. Get a cup of coffee or, better yet, go for a walkoutside. A 1 TB drive will take about 30 hours to be encrypted. The 64 GB drive takes about30 minutes.In the next window, you will be asked to create a passphrase for the drive encryption. Youwill use this passphrase when booting up Kali. Note the term .passphraseUse something long but easy to remember: a line from a song or a poemor quote! The longer the better! .Mary had a little lamb and walked it to townEven with no numbers in this phrase it would take John the Ripper over amonth to crack this.

Sharpening the SawChapter 2
[ 49 ]Next you will be asked to confirm these changes. Pick Finish partitioning and writechanges to disk Continueand then click .Now the system will start the partitioning process.
After the partitioning process, the system install will start. USB is a slow protocol, evencompared to ATA hard drives, so it might be time to warm up your tea.
Next you will be asked if you want to use a Network Mirror. Click  on this! This willYesselect repository mirrors close to your location and help speed up your updates later whenyou update your system.Your installation process will now complete and you will be asked to reboot the system. Besure and remove the install disk before rebooting.

Sharpening the SawChapter 2
[ 50 ]Booting your new installation of KaliNow we're ready to fire up Kali. Insert your Kali USB drive into your machine and power itup. In the beginning of the boot process you will be given the ability to manually select aboot drive. The specific keystroke will vary depending on the type and make of yourmachine. By whatever process your machine uses you will be given a menu of the availabledrives to boot from. Pick the USB drive and continue. When the system boots, you will bepresented with a screen asking for your passphrase. This is the passphrase you chose earlierduring the installation. This is not the root login password. Enter the passphrase and hit theEnter key.
This will start the actual boot process of the system from the now unencrypted drive. Oncethe system is booted up you will be a login screen as follows. The following screen is whatyou would see if you had installed the e17 flavor of Kali Linux.

Sharpening the SawChapter 2
[ 51 ]In the e17 flavor, you log into the Terminal emulator screen with your root credentials, andthen type  to open the GUI.startxThe following screenshot is what you would see if you had installed the standard Gnome3flavor.In the standard Gnome3 GUI installation, you will see a  ()GUI Desktop ManagerGDMlogin screenshot as follows:
Hacker trick:Before we go any further we would advise you to use these tools only onsystems you have written authorization to test, or systems that youpersonally own. Any use of these tools on a machine you do not haveauthorization to test is illegal under various Federal and State laws. Whenyou get caught, you will go to jail. Sentences for hacking tend to beexorbitantly long.Get a personal copy of the testing waiver that your company receives toallow them to test the client's network and systems. This document shouldcontain the dates and times of testing and the IP addresses and/ornetworks to be tested. This is the scope of your testing. This document isyour . Do not test without this.Get out of jail free card

Sharpening the SawChapter 2
[ 52 ]Now with that said let's log in and continue our set up. The following screenshot shows theGnome3 desktop.
On your first login, check that everything is up to date. Since this is a rolling distribution,there will almost always be a few updates. There are a few ways to get to your terminalemulator:Pull up a terminal widow by clicking in the  menu bar in the upper1.Applicationsleft hand corner. Go to  |  |  |ApplicationsUsual applicationsSystem toolsTerminal.In the same  menu, go to  | .2.ApplicationsApplicationsFavorites |TerminalYou might notice that the  menu is also displayed as a button bar on the3.Favoritesleft side of the desktop. Click the  button.TerminalOn a bare-metal install (as opposed to a virtual machine installation), you can hit4.AltF2 +  to open a run dialog, then type .gnome-terminal

Sharpening the SawChapter 2
[ 53 ]Any of these should bring up the terminal or command line window. Type the following:root@kalibook :~#  apt-get updateThis will refresh the update list and check for new updates. Next, run:root@kalibook :~#  apt-get -y upgradeThis will run the upgrade process as the  automatically answers yes to the upgrade. The-ysystem will run an upgrade of all applications. Reboot if necessary.Running Kali from the Live DVDRunning Kali Linux from Live Disk is best when you are doing forensics or recovery tasks.Live Disk doesn't write anything to the machine's hard drives. Some tools, such asOpenVAS, will not work at all, because they have to be configured and file updates mustbe saved. You can't do this from the DVD.To run Kali from the DVD, just load the disk in the machine you are testing and boot fromit. You will see the following screen. This is the screen from which you chose the GraphicalInstaller in an earlier section of this chapter. We will discuss the options now. Note thatthere are several options in boot live from the DVD.Booting from the first option loads Kali complete with a working network stack.You can run a lot of the tools over the network with this option. One of the bestuses for this mode is the recovery of a dead machine. It may allow you toresurrect a crashed machine after the OS drive dies. No matter what voodoo youdo with fsck and other disk utilities it just will not come back up on its own. Ifyou boot from the live DVD, you can then run fsck and most likely get the driveback up enough to copy data from it. You can then use Kali to copy the data fromthe drive to another machine on the network.Booting from the second option will boot Kali with no running services and nonetwork stack. This option is good when things really go bad with a system.Perhaps it was struck by lightning and the Network interface card is damaged.You can do the above operation and copy the data to a mounted USB drive inthis mode.

Sharpening the SawChapter 2
[ 54 ]The third option is Forensic Mode. When booted with this option it does its bestnot to touch the machine itself when booting. No drives are spun up and thememory is not fully flushed as with a normal boot up. This allows you to captureold memory from the last boot and allows you to do a forensic copy of any driveswithout actually touching the data. You do not have a working network stack orrunning services.Booting from the fourth and fifth options requires you to install Kali onto a USBdrive and run it from the USB drive. When you boot from the USB you will getthe same screen but you will pick one of these options. For the USB withPersistence options, see the link listed () for an excellenthttp://kali.org/prsttutorial.If you are comfortable with the Linux command line, you may want the sixthoption. This is the  installer. It has all the functions of theDebian Ncursesgraphical installer, but is lacks the modern slick look of the graphical installer.You can also use this installer with the option for fully installing to an encryptedUSB. The steps are all the same.Graphical install is for installing directly to a hard drive and, as in ourdemonstration, you can also use it to do a full install to a USB or Flash Drive.

Sharpening the SawChapter 2
[ 55 ]Installing and configuring applicationsMost of what you need comes preloaded on Kali. If you are working with Kali in specificareas, Kali provides a list of specific categories of tools in the https://tools.kali.org/kali-metapackages page, shown in the following screenshot:
That is a useful data source, but it may complicate your life a little, by forcing you to makechoices. There are a few applications we have found useful that are not loaded with thebase install. We will also set up and configure OpenVAS for use as our vulnerabilityscanner.

Sharpening the SawChapter 2
[ 56 ]Gedit  the Gnome Text Editor–Kali comes with  as its default text editor. This is a very lightweight text editor.LeafpadKali's desktop is Gnome-based and the Gnome text editor  is a much better editor. ToGeditinstall:root@kalibook :~#  apt -y install geditOnce installed, you will find it under  | .Usual applicationsAccessoriesGeany  the platform-agnostic code IDE–Geany is Wolf's favorite text editor/IDE. It has a lot of string editing capability, as well asautomatic code-tag closures and highlighting. Finally, it works on any platform from Kalito Windows. It is a time-saver to have an editor that works the same on all the platformsyou touch. Just a few more of the features from the Geany Project website (https://www.geany.org/Main/About) are as follows:Build system to compile and execute your codeCode foldingCode navigationConstruct completion/snippetsSymbol name auto-completionMany supported file types including C, Java, PHP , HTML, Python, Perl, andmany moreSymbol listsSimple project managementPlugin interfaceTo install:root@kalibook :~#  apt -y install geanyOnce installed you will find it under  | .Usual applicationsProgramming

Sharpening the SawChapter 2
[ 57 ]The following screenshot shows the implementation of Geany on Kali Linux. Note the codehighlighting and the included terminal to show the output.
Terminator  the Terminal emulator for multi-–taskingThis is Bo's favorite terminal application. You can split the screen into several windows.This turns out to be a great help when running several SSH sessions at the same time. Italso has a broadcast function where you can run the same string in all windows at the sametime. Here are some more major features from the terminator website (https://gnometerminator.blogspot.com/p/introduction.html):Arrange terminals in a gridTabsDrag and drop re-ordering of terminalsKeyboard shortcutsGUI preferences editor that lets you save multiple layouts and profiles

Sharpening the SawChapter 2
[ 58 ]To install:root@kalibook :~#  apt -y install terminator
Etherape  the graphical protocol-analysis tool–This is a great visual passive/active network sniffing tool. It works well for sniffing Wi-Finetworks. It shows you where the services are running and can also show you where usersare doing suspicious bit-torrent downloads and other behaviors that are not approved onmost corporate networks.

Sharpening the SawChapter 2
[ 59 ]To install:root@kalibook :~#  apt -y install etherape
Setting up and configuring OpenVASRecon is everything, so a good vulnerability scanner is essential. Kali used to come with OpenVAS installed. Now you have to install OpenVAS.To install:root@kalibook :~#  apt -y install openvas

Sharpening the SawChapter 2
[ 60 ]It must be configured and updated before use. Fortunately, Kali comes with a helpful scriptto set this up. This can be found under  |  | ApplicationsVulnerability analysisopenvasinitial setup. Clicking on this will open a Terminal window and run the script for you. Thiswill set up self-signed certificates for SSL and download the latest vulnerability files andrelated data. It will also generate a password for the admin account on the system.Be sure and save this password; you will need it to log in. You can changeit after your first login.
Kali also comes with a check set up script which will check the services and configuration.If an issue does come up it will give you help information on the issue. This script can befound at  |  | .ApplicationsSystem Servicesopenvas check setup

Sharpening the SawChapter 2
[ 61 ]Click this and a Terminal window will open and run the script.
The script results are as shown in the following screenshot:

Sharpening the SawChapter 2
[ 62 ]Note this check shows the running ports for the services. The check shows a warning to theeffect that these services are only running on the local interface. This is fine for your work.It may at some point be useful for you to run the OpenVAS server on some other machineto improve the speed of your scans.Next we will log into the Greenbone web interface to check Openvas.Open the browser and go to . You will be shown a1.https://localhost:9392security warning for a self-signed certificate; accept this and you will get a loginscreen, as follows:
You will log in with the user name  and the very long and complex2.adminpassword generated during the set up. Don't worry, we're going to change thatonce we get logged in. Once logged in you will see the following page.

Sharpening the SawChapter 2
[ 63 ]Now go to the  |  as follows:3.AdministrationUsers tab
This will take you to the user administration page.Click the wrench link to the right of the name ; this will open the edit page4.adminfor the admin user.

Sharpening the SawChapter 2
[ 64 ]Change the radio button for  to the blank field; add your new5.Use existing valuepassword and click the  button.Save

Sharpening the SawChapter 2
[ 65 ]We've now finished setting up OpenVAS and we're ready to do some real work.Reporting testsClean and clear documentation helps you report your work. There are two documentationtools we use to keep documentation organized:KeepNoteDradisA document organizer is a not just a glorified text editor or weak word processor. Properdocumentation requires an organized filing structure. Certainly, a Windows securityanalyst could create a folder structure that lets them organize the documents in Kali Linux,just as they would on their Windows workstation. It is in-built in document organizingapplications and using them reduces the chance of losing, or accidentally recursing, yourfolders. It is easier to keep track of your investigation's documentation. You can also createtemplates for the directory structure so you can standardize on a structure, which alsomakes your work easier.KeepNote  stand-alone document organizer–KeepNote is a simpler tool, and quite sufficient if you are working alone. To findKeepNote, open the  menu and click on  |  |ApplicationApplicationsUsual applicationsOfficeKeepNote | . The following screenshot shows a KeepNote setup similar to the wayyou would record a short test.

Sharpening the SawChapter 2
[ 66 ]Hacker note:To edit images, as shown in the preceding screenshot, open a terminal andtype:root@kalibook: ~# apt install gimpThen drag the images from your working image directoryinto the keepnote directory.

Sharpening the SawChapter 2
[ 67 ]Dradis  web-based document organizer–Dradis is a web application, and can be used to share documentation with a team. Thedefault URL for Dradis is . The application can be hosted on ahttps://127.0.0.1:3004remote secure server, and that is the best feature about Dradis. The following screenshotcomes from .http://dradisframework.org
Running services on Kali LinuxThere are several services that you will want to turn on when you need them. The generaluse of services in Windows and Linux is to have them start when the computer boots up.Most administrators spend little time managing services unless something goes wrong. Inthe Kali system, you will tend to shut down the workstation when you are not actuallydoing security analysis tasks, and you certainly do not want security tools, such asOpenVAS or Metasploit, that you have on your workstation to be accessible over theinternet. This means that you will want to start them when you need them and shut themdown when you are not using them.

Sharpening the SawChapter 2
[ 68 ]You can find the commands to start and stop Kali Services from the Applicationsmenu | —ApplicationsSystem Services
Another way to work with services is by using  on the command line. As ansystemctlexample, consider HTTP (Apache2). There are several options for services:Startprocess IDPID: This starts the Apache webserver and shows the  ().Status: Shows the status of the server. Is it up? Is it down? Is it stuck?Restart: Takes the server down and restarts it on a different PID. Use this if theserver is stuck or if you have changed the networking processes on which theserver depends.Reload: Re-reads the configuration. Use this when you make minor changes toconfigurations.Stop: This shuts down the webserver.

Sharpening the SawChapter 2
[ 69 ]The following screenshot shows A readout comparing  and  for aapache2ctlsystemctlstatus request for the apache2 webserver. An entire book could probably be written aboutthe powerful  command.systemctl
SummaryThis chapter shows you two ways to set up Kali Linux so that you can use your company-issued Windows laptop, or any other laptop, to get better performance out of Kali Linuxand not to have requisition to a new machine just for Kali. Most enterprises do not allowyou to dual-boot your computer, and running Kali on a VM throttles the resources for yourKali installation. Further, this chapter shows you the two reporting tools we use, and thesituations where each of these tools makes the most sense. We show you how to set upOpenVAS for the first time. We also show you how to run services on Kali Linux.

3333 3Information Gathering andVulnerability AssessmentsThere is a myth that all Windows systems are easy to exploit. This is not entirely true.Almost any Windows system can be hardened to the point that it takes too long to exploitits vulnerabilities. In this chapter, you will learn how to footprint your Windows networkand discover the vulnerabilities before the bad guys do.You will also learn ways to investigate and map your Windows network to find Windowssystems that are susceptible to exploits. In some cases, this will be adding to yourknowledge of the top 10 security tools; in others, we will show you entirely new tools tohandle this category of investigation.We will cover the following topics in this chapter:Footprinting the networkAn annotated list of Nmap command optionsUsing OpenVASUsing MaltegoUsing KeepNoteTechnical requirementsTo follow along with this chapter, you will need the following:A running version of Kali LinuxSome Windows hosts on a network to scan

Information Gathering and Vulnerability AssessmentsChapter 3
[ 71 ]Footprinting the networkYou can't find your way without a good map. In this chapter, we are going to learn how togather network information and assess vulnerabilities on the network. In the hacker world,this is called . This is the first step to any righteous hack. This is where you willfootprintingsave yourself time and massive headaches.Without footprinting your targets, you are just shooting in the dark. The biggest tool in anygood penetration tester's toolbox is your . You have to have the mind of a sniper.mindsetYou learn your target's habits and its actions. You learn the traffic flows on the networkwhere your target lives. You find the weaknesses in your target and then attack thoseweaknesses. Search and destroy!In order to do good footprinting, you have to use several tools that come with Kali. Eachtool has it strong points and looks at the target from a different angle. The more views ofyour target, the better plan of attack you have.Footprinting will differ depending on whether your targets are external on the publicnetwork, or internal and on a LAN. We will be covering both of these aspects.Scanning and using these tools against a machine on a public network,which you do not have written permission to access, is a Federal crime.In this book, for most instances of Kali Linux, we will be using virtual machines running onVMwareOracle VirtualBox and  that are built specifically for this book. The instances ofKali that we use on a daily basis are fairly heavily customized, and it would take a wholebook just to cover the customizations. For external networks, we will be using several liveservers on the internet.Please be respectful and leave these addresses alone, as two of them areBo's personal servers, and several are in the Atlanta Cloud Technologyserver cluster.Please read the preceding note again, and remember you do not have our permission toattack these machines. .Don't do the crime if you can't pay the time

Information Gathering and Vulnerability AssessmentsChapter 3
[ 72 ]NmapYou can't talk about networking without talking about . Nmap is the Swiss ArmyNmapknife for network administrators. It is not only a great footprinting tool but also the bestand cheapest network analysis tool any sysadmin can have on their machine. It really is theSwiss Army knife of network analysis:It's a great tool for checking a single server to make sure the ports are operatingproperlyIt can heartbeat-ping an entire network segment or several hosts on a networkIt can even discover machines when ICMP (ping) has been turned offIt can be used to pressure-test services. If the machine freezes under the load, itneeds repairsNmap was created in 1997 by Gordon Lyon, who goes by the handle Fyodor on theinternet. Fyodor still maintains Nmap and it can be downloaded from http://insecure.org. You can also order his book about Nmap on that website. It is a great book. Well worththe price! Fyodor and the Nmap hackers have collected a great deal of information andsecurity email lists on the site. Since you are running Kali Linux, you have a full copy ofNmap already installed!Here is an example of Nmap running against a Kali Linux instance:Open the Terminal from the icon on the top bar or by clicking on the menu links:1.ApplicationAccessoriesTerminalRoot Terminal |  | . You could also choose the if you want, but since you are already logged in as , you will not see anyRootdifference.Type  at the Command Prompt. (You need to put in the IP of2.nmap -A 10.0.0.4the machine you are testing.)The output shows the open ports among 1,000 commonly used ports. In this3.example, there are no open ports, so to make it a little more interesting, do thefollowing.Start the built-in web server by typing .4./etc/init.d/apache2 startWith the web server started, run the Nmap command again, as follows: nmap -A5.10.0.0.4.

Information Gathering and Vulnerability AssessmentsChapter 3
[ 73 ]As you can see, Nmap is attempting to discover the OS and to tell what web6.server version:
The following is an example of running Nmap from the Git Bash application, which letsyou run Linux commands on your Windows Desktop. This view shows a neat feature ofNmap. If you get bored or anxious and think the system is taking too much time to scan,you can hit the down arrow key and it will print out a status line to tell you whatpercentage of the scan is complete. This is not the same as telling you how much time is leftto the scan, but it does give you an idea of what has been done:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 74 ]Nmap also comes as a Windows-installable application for your Windows machine. If youare a network or systems admin, you'll find this a great tool, not just for footprinting, butfor systems and network troubleshooting. For other systems, you can find the Nmapinstallers at .https://nmap.org/download.html

Information Gathering and Vulnerability AssessmentsChapter 3
[ 75 ]ZenmapNmap comes with a GUI called . Zenmap is a friendly graphical interface for theZenmapNmap application. You will find Zenmap under  |  |Kali LinuxInformation GatheringNetwork ScannersZenmap | . The interface looks as follows:
One of the cool features of Zenmap is that, when you set up a scan using the buttons, theapplication also writes out the command-line version of the command, which will help youlearn the command line flags used with Nmap in command-line mode.Hacker tip:Most hackers are very comfortable on the Linux Command-Line Interface(). You want to learn Nmap commands on the command line, becauseCLIyou can use Nmap inside automated bash scripts and make up cron jobsto make routine scans much simpler. You can set a cron job to run the testin non-peak hours, when the network is quieter, and your tests will haveless impact on the network's legitimate users.

Information Gathering and Vulnerability AssessmentsChapter 3
[ 76 ]The intense-scan choice produces a command line of :nmap -T4 -A -vThis produces a fast scan; the  stands for Timing (from 1 to 5), and the defaultTtiming is . The faster the timing, the rougher the test, and the more likely you-T3are to be detected if the network is running an Intrusion Detection System().IDSWith a deep port scan, including OS identification and attempts to find theapplications listening on the ports, and the versions of those applications. -Astands for All.Finally, the  stands for verbose.  means very verbose.-v-vvIn the following, we see a list of the most common scans in a drop-down box:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 77 ]The difference verbosity makesThe next three screenshots show the difference verbosity makes in an OS scan. The OS scanincludes a stealth scan, so  is exactly the same as nmap -O hostnamenmap -sS -Ohostname:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 78 ]The verbose version here has been adjusted slightly to fit all the detail into the screenshot.The different scan options have different enhanced content when the  or  options are-v-vvadded to the search strings. It makes sense to use  or  when you have chosen some-v-vvlikely targets using the basic display option:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 79 ]In the next screenshot, we have added another  () to the verbosity flag and rerun thev-vvscan. As we can see, a lot more information about the system and the scan is outputted:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 80 ]Scanning a network rangeThe following example has a network range of , and the scan type192.168.202.0/24chosen is an intense scan with no ping. You then click the  button and your scan runs.ScanDuring the scan, you will see the output in the  tab on the screen. From ourNmap Outputscan, we see we have six active hosts on the network. From the icons next to the IPaddresses, we can tell we have identified two Windows machines, two Linux machines,and two unknown OS systems. Notice how, in the  field in the followingCommandscreenshot, as you set your scan variables, the command-line variables show up in thisfield. This is a good way to learn how to use Nmap from the command line:
If a network has ICMP turned off, attempting to ping the machines takes alot of time. It takes almost as long as pinging UDP ports on the targetmachines. For either case, each machine will take approximately 75seconds per port. In the first case, that means a ping of six machines takes450 seconds just to fail the ping test. UDP searches test many more portsper machine. At 1,000 ports tested per standard UDP-port scan, you aregoing to take about 21 hours per machine just to test UDP . If you don'thave a really good reason to check UDP ports with Nmap, it is not a cost-effective exercise.

Information Gathering and Vulnerability AssessmentsChapter 3
[ 81 ]By clicking the  tab and then clicking the  button, you get a nice listTopologyHosts Viewerof the hosts. By clicking the addresses, you can see the details of each host. Note that theaddresses are different colors. Nmap picks out the low-hanging fruit for you. Green meanssecured, whereas yellow and red have vulnerabilities or services and could be exploited:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 82 ]Zenmap also has a nice feature for comparing scans. You will find it in the menu bar underToolsCompare Results | . In the following screenshots, you will see that we ran two scanson the network. When we compare the two, we can see that, on the second scan, a newmachine was found. In the results of the first scan, it is marked in red, and shows192.168.202.131 as down. When it is green, it is showing it as up, and displays the openports and system information:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 83 ]The following screenshot is the result of running Nmap from the command line. As yousaw previously, Nmap has been ported to Windows. If your company allows it, Nmap canbe run on a Windows system by the command line in either the command window orthrough Windows PowerShell:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 84 ]If you have a large network, and just want to find Windows machines so that you can focuson Windows vulnerabilities, you can run the Quick Scan with the following command:nmap -T4 -F 10.0.0.0/24nmap -sV -. Or, you can opt for Quick Scan Plus by typing T4 -O -F -version-light 10.0.0.0/24. These will give you a good idea of whichmachines you really want to focus on. It looks like  is a Windows machine,10.0.0.12based on the fact that four of five open ports are Windows-related:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 85 ]When you are looking at the  tab, you can adjust the size of the group byTopologychanging the values of the controls at the bottom of the window. The size of the graphic isincreased by increasing . The standard view puts the local host at the centerinterest factorof the grouping, but if you click on one of the other hosts, it is brought to the center, asfollows:

Information Gathering and Vulnerability AssessmentsChapter 3
[ 86 ]An annotated list of Nmap command optionsEven though Zenmap has a short, punchy drop-down list of popular and useful scans,there are quite an assortment of commands and options that you can use in customizingyour scans.Where can you find instructions on this thing?On a Linux box, there are three places where you can find more information about acommand-line application:The help page: Almost all Unix and Linux applications have a help file that youcan access by typing the application name and  on the command line. Consider-hthe following as an example: .root@kali-01: ~# nmap -hThe man page: This is a full manual for most modern command-lineapplications, which you can access by typing  and the application name onmanthe command line. See the following for an example: . Thisroot@kali-01: ~#-gets you a pretty good explanation of how to use Rsync, the secure and loggedfile transfer protocol. Man pages are of varying quality, and many of them areactually written by rocket scientists, so a newbie may have to research how toread the manual page before it will be useful to them. The Nmap man page isclearly written, with understandable examples to try out.Info pages: For Bash shell built-ins, there is a group of information pages, insteadof man pages. To get at the info pages, type  and the application name. Forinfoexample,  will present you with the info page forroot@kali-01: ~# info lsthe ls command, which is the Linux version of the DIR command in DOS.The  commands present you with in-line text in the Terminal window, so you are-hreturned to the Command Prompt immediately after the information scrolls past. The manand  commands launch the text reader, , so you can scroll up and down on theinfoLessdocument, even though you are still in the Terminal window. To escape from , justLesspress the Q key.The Shift key is your friend in the Linux Terminal Emulator.If you want to scroll up and down in the Terminal window, for instance, if the  help file-his longer than a single screen, just hold Shift + the up or downcursor key.The hot-key sequence for copy and paste are  +  +  and  +  + ,ShiftCtrlCShiftCtrlVrespectively.  +  means close the running application in the Bash Shell, and  + CtrlCCtrlVdoes nothing at all.

Information Gathering and Vulnerability AssessmentsChapter 3
[ 87 ]The Nmap 6.47 help file can be found at .http://nmap.orgUsage: nmap [Scan Type(s)][Options] {targetspecification}TARGET SPECIFICATION:Ex:atlantacbudtech.comaarrrggh.com/26, ,192.168.3.11110.1-16.0-255.1-254; -L <inputfilename>:Input from list of hosts/networks.-R <num hosts>:Choose random targets.-exclude <host1, [host2],[host3], ...>: Exclude hosts/networks.-exludefile <exclude_file>:Exclude list from file.HOST DISCOVERY:-sL:List Scan - simply list targets to scan.-sn:Ping Scan - disable port scan.-Pn:Treat all hosts as online - skip the ping for host discovery.-PS/PA/PU/PY [portlist]:TCP SYN/ACK, UDP or SCTP discovery to given ports.-PE/PP/PM:ICMP echo, timestamp, and netmask requestdiscovery probes.-PO [protocol list]:IP protocol ping, as opposed to ICMP ping.-n/-R:Never do DNS resolution/Always resolve[default:sometimes].Resolving DNS gives you more information about the network, but itcreates DNS request traffic, which might alert a sysadmin that there issomething going on that is not entirely normal, especially if they are notusing DNS in the network.This is a view of the help file that comes with Nmap, with our comments included (you canfind much more at the manual page at ):http://nmap.org/book/man/--dns-servers <serv1[,serv2],...>: Specify custom DNS servers.--system-dns: Use OS's DNS resolver. This is the default behavior.--traceroute: Trace the hop path to each host. This would only make sense inlarge, complicated, segmented networks.

Information Gathering and Vulnerability AssessmentsChapter 3
[ 88 ]Scan techniques:-sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans-sU: UDP scan-sN/sF/sX: TCP Null, FIN, and Xmas scans--scanflags <flags>: Customize TCP scan flagsNS - ECN-nonce concealment protection (this is experimental: see RFC 3540 for moreinformation).CWR: Congestion Window Reduced. Used to indicate that packets are beingreduced in size to maintain traffic under congested network conditions.ECE: ECN-Echo has a dual role, depending on the value of the SYN flag:If the SYN flag is set (1), then it indicates that the TCP peer is ECN-capable.If the SYN flag is clear (0), then it indicates that a packet with aCongestion Experienced flag in the IP header set is received duringnormal transmission (this is added to the header by RFC 3168).URG: This indicates that the Urgent pointer field issignificant.ACK: This indicates that the Acknowledgment field issignificant.PSH: The Push function. Asks to push the buffereddata to the receiving application.RST: Reset the connection.SYN: Synchronize sequence numbers.FIN: No more data from sender.-sI <zombie host[:probeport]>: Idle scan.-sY/sZ: SCTP INIT/COOKIE-ECHO scans.-sO: IP protocol scan.-b <FTP relay host>: FTP bounce scan.Port specification and scan order:-p <port ranges>: Only scan specified ports.

Information Gathering and Vulnerability AssessmentsChapter 3
[ 89 ]For example, consider the following code: -p22; -p1-65535; -pU:53,111,137,T:21-25,80,139,8080,S:9-F: Fast modescan fewer ports than the default scan—-r: Scan ports consecutively-don't randomize--top-ports <number>: Scan <number> most common ports--port-ratio <ratio><ratio>: Scan ports more common than a given Service/version detection:-sV: Probe open ports to determine service/version info--version-intensity <level>: Set from 0 (light) to 9 (try all probes)--version-light: Limit to the most likely probes (intensity 2)--version-all: Try every single probe (intensity 9)--version-trace: Show detailed version of scan activity (for debugging)Script scan:-sC-script=default: equivalent to --script=<Lua scripts><Lua scripts>:  is a comma-separated list ofdirectories, script-files, or script-categories--script-args=<n1=v1,[n2=v2,...]>: provide arguments to scripts--script-args-file=filename: provide NSE script arguments in a file--script-trace: Show all data sent and received--script-updatedb: Update the script database--script-help=<Lua scripts>: Show help about scripts<Lua scripts> is a comma-separated list of script-files or script-categoriesOS detection:-O: Enable OS detection--osscan-limit: Limit OS detection to promising targets--osscan-guess: Try to guess the OS more aggressively


[Note: PDF has 396 pages, only first 100 pages extracted]